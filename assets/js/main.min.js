$(document).ready(function () {
  AOS.init();
  // xử lí cấn menu
  // window.onscroll = function (e) {
  //   // print "false" if direction is down and "true" if up
  //   console.log(this.oldScroll > this.scrollY);

  //   if (this.oldScroll > this.scrollY) {
  //     this.document.querySelector(".menu_container").classList.remove("to-top");
  //   } else {
  //     this.document.querySelector(".menu_container").classList.add("to-top");
  //   }
  //   this.oldScroll = this.scrollY;
  // };

  // onclick menu ------------

  var ul = document.getElementById("list_menu");
  var liItems = ul.getElementsByTagName("li");

  for (var i = 0; i < liItems.length; i++) {
    liItems[i].onclick = function () {
      // menuItem
      var active = ul.getElementsByClassName("active");
      if (active.length > 0) {
        active[0].classList.remove("active");
      }
      this.classList.add("active");
      // active
      var activeSs = document.getElementsByClassName("active_ss");

      if (activeSs.length > 0) {
        console.log(activeSs[0]);
        activeSs[0].classList.remove("active_ss");
      }
      document.querySelector(".img_icon").src = "assets/images/img_icon.png";
      classNameOfSection = ".section_" + this.value;
      document.querySelector(classNameOfSection).classList.add("active_ss");
      // this.classList.add("active_ss");
      // location.reload();

      window.scrollTo({ top: 0 });

      AOS.refresh();
    };
  }
  document.querySelector(".img_icon").onclick = () => {
    console.log(123123);
    var activeSs = document.getElementsByClassName("active_ss");
    if (activeSs.length > 0) {
      console.log(activeSs[0]);
      activeSs[0].classList.remove("active_ss");
    }
    document.querySelector(".section_0").classList.add("active_ss");
    AOS.refresh();
    //doi mau
    document.querySelector(".img_icon").src =
      "assets/images/img_icon_active.png";
    // Ẩn cái menu đi luôn
    document.querySelector(".menu_container").classList.add("none");
    document.querySelector(".menu_container_mobile").classList.add("none");
  };

  //-------------------
  //Xử lí menu của mobile

  //start form home = 0
  var index = 1;

  //click button;

  var convertIndex = (i) => {
    trueValue = 0;
    switch (i) {
      case 1:
        trueValue = 4;
        break;
      case 2:
        trueValue = 2;
        break;
      case 3:
        trueValue = 3;
        break;
      case 4:
        trueValue = 5;
        break;
      case 5:
        trueValue = 1;
        break;
    }

    return trueValue;
  };

  let onclickButtonSlider = (number) => {
    if (number == 1) {
      if (index == 5) {
        index = 1;
      } else {
        index++;
      }
    } else {
      if (index == 1) {
        index = 5;
      } else {
        index--;
      }
    }
    var activeSs = document.getElementsByClassName("active_ss");
    if (activeSs.length > 0) {
      activeSs[0].classList.remove("active_ss");
    }
    document.querySelector(".img_icon").src = "assets/images/img_icon.png";
    classNameOfSection = ".section_" + convertIndex(index);
    document.querySelector(classNameOfSection).classList.add("active_ss");

    window.scrollTo({ top: 0 });
  };

  //add event to button swipper

  document.querySelector(".img_icon_mobile").onclick = () => {
    console.log(123123);
    var activeSs = document.getElementsByClassName("active_ss");
    if (activeSs.length > 0) {
      console.log(activeSs[0]);
      activeSs[0].classList.remove("active_ss");
    }
    document.querySelector(".section_0").classList.add("active_ss");
    AOS.refresh();
    // Ẩn cái menu đi luôn
    document.querySelector(".menu_container").classList.add("none");
    document.querySelector(".menu_container_mobile").classList.add("none");
  };
});

// Trỏ vào button Thư Viện

var convertIndex = (i) => {
  trueValue = 0;
  switch (i) {
    case 1:
      trueValue = 4;
      break;
    case 2:
      trueValue = 2;
      break;
    case 3:
      trueValue = 3;
      break;
    case 4:
      trueValue = 5;
      break;
    case 5:
      trueValue = 1;
      break;
  }

  return trueValue;
};

bookIndex = 0;
let changeTitle = () => {
  var bookActive = document.querySelectorAll(".book_active");
  for (var i = 0; i < bookActive.length; i++) {
    bookActive[i].classList.remove("book_active");
  }
  bookTitleClassName = ".title_" + bookIndex;
  //vi moi title co 2 ban mobile va pc
  listTitle = document.querySelectorAll(bookTitleClassName);
  for (var i = 0; i < listTitle.length; i++) {
    listTitle[i].classList.add("book_active");
  }
};

// click to chuyen trang

var loadPage = (id) => {
  var activeSs = document.getElementsByClassName("active_ss");
  if (activeSs.length > 0) {
    activeSs[0].classList.remove("active_ss");
  }

  var name = "#s_" + id;
  console.log(name);
  document.querySelector(name).classList.add("active_ss");
  window.scrollTo({ top: 0 });

  // set menu
  var ul = document.getElementById("list_menu");
  var liItems = ul.getElementsByTagName("li");
  var active = ul.getElementsByClassName("active");
  if (active.length > 0) {
    active[0].classList.remove("active");
  }

  for (var i = 0; i < liItems.length; i++) {
    // menuItem
    if (liItems[i].value == id) {
      liItems[i].classList.add("active");
    }
  }

  //hien menu
  document.querySelector(".menu_container").classList.remove("none");
};

var chuyenTrang = () => {
  loadPage(bookIndex);

  //check settimeout chi chay khi tren mobile
  // sau do check goi tao roi hay chua bang 1 flag. neu co moi tao
  setTimeout(function () {
    document.querySelector(".menu_container_mobile").classList.remove("none");
    if ($(".mySwiper").length > 0) {
      var swiper = new Swiper(".mySwiper", {
        slidesPerView: 1,
        spaceBetween: 30,
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
        navigation: {
          nextEl: ".swiper-button-next",
          prevEl: ".swiper-button-prev",
        },
        on: {
          transitionStart: function () {
            loadPage(swiper.activeIndex);
          },
        },
      });
    }
    swiper.slideTo(bookIndex);
  }, 500);
};

//xử lí kéo thả
var myDiv = document.querySelector("#mybook");
var isDragging = false;
var startX = 0;
var isGo = true;
myDiv.addEventListener("mousedown", function (event) {
  isDragging = true;
  startX = event.clientX;
});

var flag = false;
myDiv.addEventListener("mousemove", function (event) {
  if (isDragging) {
    var currentX = event.clientX;
    var distance = Math.abs(currentX - startX);
    if (distance > 100) {
      isGo = false;
      // Kiểm tra khoảng cách kéo
      if (currentX > startX) {
        flag = true;
      } else {
        flag = false;
      }
    }
  }
});
myDiv.addEventListener("mouseup", function () {
  isDragging = false;
  if (!isGo) {
    if (!flag) {
      if (bookIndex < 4) {
        bookIndex++;
      }
      console.log(bookIndex);
      document.querySelector("#next_page_button").click();
    } else if (flag) {
      if (bookIndex > 0) {
        bookIndex--;
      }
      console.log(bookIndex);
      document.querySelector("#prev_page_button").click();
    }
    changeTitle();
  }

  if (isGo) {
    chuyenTrang();
  }
  isGo = true;
});
