$(document).ready(function () {
  AOS.init();
  // xử lí cấn menu
  // window.onscroll = function (e) {
  //   // print "false" if direction is down and "true" if up
  //   console.log(this.oldScroll > this.scrollY);

  //   if (this.oldScroll > this.scrollY) {
  //     this.document.querySelector(".menu_container").classList.remove("to-top");
  //   } else {
  //     this.document.querySelector(".menu_container").classList.add("to-top");
  //   }
  //   this.oldScroll = this.scrollY;
  // };

  // onclick menu pc ------------

  var ul = document.getElementById("list_menu");
  var liItems = ul.getElementsByTagName("li");

  for (var i = 0; i < liItems.length; i++) {
    liItems[i].onclick = function () {
      console.log("here");
      // menuItem
      var active = ul.getElementsByClassName("active");
      if (active.length > 0) {
        active[0].classList.remove("active");
      }
      this.classList.add("active");
      // active
      var activeSs = document.getElementsByClassName("active_ss");

      if (activeSs.length > 0) {
        console.log(activeSs[0]);
        activeSs[0].classList.remove("active_ss");
      }
      document.querySelector(".img_icon").src = "assets/images/img_icon.png";
      classNameOfSection = "#s_" + this.value;
      document.querySelector(classNameOfSection).classList.add("active_ss");
      // this.classList.add("active_ss");
      // location.reload();

      window.scrollTo({ top: 0 });

      AOS.refresh();
    };
  }
  document.querySelector(".img_icon").onclick = () => {
    console.log(123123);
    var activeSs = document.getElementsByClassName("active_ss");
    if (activeSs.length > 0) {
      console.log(activeSs[0]);
      activeSs[0].classList.remove("active_ss");
    }
    document.querySelector(".section_0").classList.add("active_ss");
    AOS.refresh();
    //doi mau
    document.querySelector(".img_icon").src =
      "assets/images/img_icon_active.png";
    // Ẩn cái menu đi luôn
    document.querySelector(".menu_container").classList.add("none");
    document.querySelector(".menu_container_mobile").classList.add("none");
  };

  // // END  onclick menu pc ------------

  //Xử lí menu của mobile

  //start form home = 0
  var index = 1;

  //click button;

  //add event to button swipper
  document.querySelector(".img_icon_mobile").onclick = () => {
    console.log(123123);
    var activeSs = document.getElementsByClassName("active_ss");
    if (activeSs.length > 0) {
      console.log(activeSs[0]);
      activeSs[0].classList.remove("active_ss");
    }
    document.querySelector(".section_0").classList.add("active_ss");
    AOS.refresh();
    // Ẩn cái menu đi luôn
    document.querySelector(".menu_container").classList.add("none");
    document.querySelector(".menu_container_mobile").classList.add("none");
  };
});

// Trỏ vào button Thư Viện

bookIndex = 0;
let changeTitle = () => {
  console.log("changeTitle");
  console.log(bookIndex);
  var bookActive = document.querySelectorAll(".book_active");
  for (var i = 0; i < bookActive.length; i++) {
    bookActive[i].classList.remove("book_active");
  }
  bookTitleClassName = ".title_" + bookIndex;
  console.log(bookTitleClassName);
  //vi moi title co 2 ban mobile va pc
  listTitle = document.querySelectorAll(bookTitleClassName);
  for (var i = 0; i < listTitle.length; i++) {
    listTitle[i].classList.add("book_active");
  }
};

// click to chuyen trang
var loadPage = (id) => {
  var activeSs = document.getElementsByClassName("active_ss");
  if (activeSs.length > 0) {
    activeSs[0].classList.remove("active_ss");
  }

  var name = "#s_" + id;
  console.log(name);
  document.querySelector(name).classList.add("active_ss");
  window.scrollTo({ top: 0 });

  // set menu
  var ul = document.getElementById("list_menu");
  var liItems = ul.getElementsByTagName("li");
  var active = ul.getElementsByClassName("active");
  if (active.length > 0) {
    active[0].classList.remove("active");
  }

  for (var i = 0; i < liItems.length; i++) {
    // menuItem
    if (liItems[i].value == id) {
      liItems[i].classList.add("active");
    }
  }

  //hien menu
  document.querySelector(".menu_container").classList.remove("none");
};

var checkIsMobileToShowMenu = function () {
  var mql = window.matchMedia("screen and (min-width: 575px)");
  if (mql.matches) {
    return false;
  } else {
    return true;
  }
};

isCreated = false;
var swiper;
var chuyenTrang = async () => {
  loadPage(bookIndex);
  console.log(bookIndex);
  //check settimeout chi chay khi tren mobile
  // sau do check goi tao roi hay chua bang 1 flag. neu co moi tao

  if (checkIsMobileToShowMenu()) {
    console.log("mobile");
    document.querySelector(".menu_container_mobile").classList.remove("none");
    if (!isCreated) {
      console.log("Tạo");
      if ($(".mySwiper").length > 0) {
        swiper = new Swiper(".mySwiper", {
          slidesPerView: 1,
          spaceBetween: 30,
          pagination: {
            el: ".swiper-pagination",
            clickable: true,
          },
          navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
          },
          on: {
            transitionStart: function () {
              loadPage(swiper.activeIndex);
            },
          },
        });
      }
      isCreated = true;
      swiper.slideTo(bookIndex);
    } else {
      swiper.slideTo(bookIndex);
    }
  } else {
    console.log("pc");
  }
};

//xử lí kéo thả (Lật trang khi ở pc) check chỉ PC mới có, vì mobile khi nhấn nó sẽ kích haotj thêm lật thì sẽ Cộng index 2 lần sảy ra sai
var checkIsMobileToUseControlBook = function () {
  var mql = window.matchMedia("screen and (min-width: 1201px)");
  if (mql.matches) {
    return false;
  } else {
    return true;
  }
};
if (!checkIsMobileToUseControlBook()) {
  console.log("PC");
  var myDiv = document.querySelector("#mybook");
  var isDragging = false;
  var startX = 0;
  var isGo = true;
  myDiv.addEventListener("mousedown", function (event) {
    isDragging = true;
    startX = event.clientX;
  });

  var flag = false;
  myDiv.addEventListener("mousemove", function (event) {
    if (isDragging) {
      var currentX = event.clientX;
      var distance = Math.abs(currentX - startX);
      if (distance > 100) {
        isGo = false;
        // Kiểm tra khoảng cách kéo
        if (currentX > startX) {
          flag = true;
        } else {
          flag = false;
        }
      }
    }
  });
  myDiv.addEventListener("mouseup", function () {
    isDragging = false;
    if (!isGo) {
      if (!flag) {
        if (bookIndex < 4) {
          bookIndex++;
        }
        document.querySelector("#next_page_button").click();
      } else if (flag) {
        if (bookIndex > 0) {
          bookIndex--;
        }

        document.querySelector("#prev_page_button").click();
      }
      changeTitle();
    }

    if (isGo) {
      chuyenTrang();
    }
    isGo = true;
  });
} else if (checkIsMobileToUseControlBook()) {
  console.log("Mobile");
  // xử click tới lui (Lật trang khi ở mobile)
  nextButtonOfBook = document.querySelector("#next_page_button").onclick =
    () => {
      if (bookIndex < 4) {
        bookIndex++;
      }

      changeTitle();
    };

  nextButtonOfBook = document.querySelector("#prev_page_button").onclick =
    () => {
      if (bookIndex > 0) {
        bookIndex--;
      }

      changeTitle();
    };

  //Them su kien click vao chuyen trang chi o mobile
  document.querySelector("#mybook").onclick = () => {
    chuyenTrang();
  };
}
